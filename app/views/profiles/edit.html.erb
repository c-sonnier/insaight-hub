<div class="container mx-auto px-4 py-8 max-w-2xl">
  <h1 class="text-3xl font-bold mb-6">Edit Profile</h1>

  <div class="card bg-base-100 shadow-xl">
    <div class="card-body">
      <%= form_with model: @user, url: profile_path, method: :patch, class: "space-y-4" do |form| %>
        <% if @user.errors.any? %>
          <div class="alert alert-error">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div>
              <h3 class="font-bold">Please fix the following errors:</h3>
              <ul class="list-disc list-inside">
                <% @user.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          </div>
        <% end %>

        <!-- Avatar Upload Section -->
        <div class="form-control" data-controller="avatar-upload" data-default-avatar-url="<%= asset_path('default_avatar.svg') %>">
          <label class="label">
            <span class="label-text font-semibold">Profile Avatar</span>
          </label>

          <div class="flex items-center gap-4">
            <div class="avatar">
              <div class="w-24 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
                <% if @user.avatar.attached? %>
                  <%= image_tag @user.avatar.variant(resize_to_limit: [200, 200]), data: { avatar_upload_target: "currentAvatar" } %>
                <% else %>
                  <%= image_tag "default_avatar.svg", data: { avatar_upload_target: "currentAvatar" } %>
                <% end %>
              </div>
            </div>

            <div class="flex flex-col gap-2">
              <%= form.file_field :avatar, accept: "image/*", class: "hidden", data: { avatar_upload_target: "input", action: "change->avatar-upload#fileSelected" } %>
              <button type="button" class="btn btn-sm btn-primary" data-action="click->avatar-upload#selectFile">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                Upload Image
              </button>
              <% if @user.avatar.attached? %>
                <button type="button" class="btn btn-sm btn-ghost" data-action="click->avatar-upload#removeAvatar">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                  Remove
                </button>
              <% end %>
            </div>
          </div>

          <label class="label">
            <span class="label-text-alt">Upload a square image for best results. You'll be able to crop and position it.</span>
          </label>

          <!-- Crop Modal -->
          <dialog data-avatar-upload-target="modal" class="modal">
            <div class="modal-box max-w-2xl">
              <h3 class="font-bold text-lg mb-4">Crop Your Avatar</h3>

              <div class="mb-4">
                <div class="max-h-96 overflow-hidden bg-base-200 rounded-lg">
                  <img data-avatar-upload-target="cropImage" class="max-w-full" />
                </div>
              </div>

              <div class="modal-action">
                <button type="button" class="btn btn-ghost" data-action="click->avatar-upload#cancelCrop">Cancel</button>
                <button type="button" class="btn btn-primary" data-action="click->avatar-upload#applyCrop">Apply</button>
              </div>
            </div>
          </dialog>
        </div>

        <div class="form-control">
          <%= form.label :name, class: "label" do %>
            <span class="label-text font-semibold">Name</span>
          <% end %>
          <%= form.text_field :name, class: "input input-bordered w-full" %>
        </div>

        <div class="form-control">
          <%= form.label :email_address, class: "label" do %>
            <span class="label-text font-semibold">Email</span>
          <% end %>
          <%= form.email_field :email_address, class: "input input-bordered w-full" %>
        </div>

        <div class="divider">Change Password</div>

        <div class="form-control">
          <%= form.label :current_password, class: "label" do %>
            <span class="label-text font-semibold">Current Password</span>
          <% end %>
          <%= form.password_field :current_password, class: "input input-bordered w-full", autocomplete: "current-password" %>
          <label class="label">
            <span class="label-text-alt">Required only if changing password</span>
          </label>
        </div>

        <div class="form-control">
          <%= form.label :password, class: "label" do %>
            <span class="label-text font-semibold">New Password</span>
          <% end %>
          <%= form.password_field :password, class: "input input-bordered w-full", autocomplete: "new-password" %>
        </div>

        <div class="form-control">
          <%= form.label :password_confirmation, class: "label" do %>
            <span class="label-text font-semibold">Confirm New Password</span>
          <% end %>
          <%= form.password_field :password_confirmation, class: "input input-bordered w-full", autocomplete: "new-password" %>
          <label class="label">
            <span class="label-text-alt">Leave password fields blank to keep current password</span>
          </label>
        </div>

        <div class="form-control">
          <%= form.label :theme, class: "label" do %>
            <span class="label-text font-semibold">Theme Preference</span>
          <% end %>
          <%
            themes = %w[light dark cupcake bumblebee emerald corporate synthwave retro cyberpunk valentine halloween garden forest aqua lofi pastel fantasy wireframe black luxury dracula cmyk autumn business acid lemonade night coffee winter dim nord sunset caramellatte abyss silk]
          %>
          <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-64 overflow-y-auto p-2 border border-base-300 rounded-lg bg-base-200">
            <% themes.each do |theme| %>
              <label class="cursor-pointer">
                <%= form.radio_button :theme, theme, class: "hidden peer" %>
                <div class="p-2 rounded-lg border-2 border-transparent peer-checked:border-primary peer-checked:bg-base-100 hover:bg-base-100 transition-all" data-theme="<%= theme %>">
                  <div class="flex items-center gap-2">
                    <div data-theme="<%= theme %>" class="bg-base-100 grid shrink-0 grid-cols-2 gap-0.5 rounded-md p-1 shadow-sm">
                      <div class="bg-base-content size-1.5 rounded-full"></div>
                      <div class="bg-primary size-1.5 rounded-full"></div>
                      <div class="bg-secondary size-1.5 rounded-full"></div>
                      <div class="bg-accent size-1.5 rounded-full"></div>
                    </div>
                    <span class="text-sm truncate"><%= theme %></span>
                  </div>
                </div>
              </label>
            <% end %>
          </div>
          <label class="label">
            <span class="label-text-alt">Choose your preferred color scheme</span>
          </label>
        </div>

        <div class="flex gap-4 pt-4">
          <%= form.submit "Save Changes", class: "btn btn-primary" %>
          <%= link_to "Cancel", profile_path, class: "btn btn-ghost" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
