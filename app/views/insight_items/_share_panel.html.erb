<div id="<%= dom_id(insight_item, :share_panel) %>">
  <h3 class="font-semibold mb-3 flex items-center gap-2">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
    </svg>
    Share Link
  </h3>

  <% if insight_item.published? %>
    <% if insight_item.shareable? %>
      <%# Share is enabled - show URL and controls %>
      <div class="space-y-3">
        <div class="form-control">
          <label class="label">
            <span class="label-text text-xs">Share URL</span>
          </label>
          <div class="flex gap-2">
            <input type="text"
                   readonly
                   value="<%= public_insight_url(insight_item.share_token) %>"
                   id="share_url_input"
                   class="input input-bordered input-sm flex-1 font-mono text-xs">
            <button type="button"
                    class="btn btn-ghost btn-sm btn-square"
                    onclick="copyToClipboard('<%= public_insight_url(insight_item.share_token) %>', this)"
                    title="Copy to clipboard">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
            </button>
          </div>
        </div>

        <div class="flex gap-2">
          <%= button_to "Disable Sharing",
                        disable_share_insight_item_path(insight_item),
                        method: :post,
                        class: "btn btn-warning btn-sm flex-1" %>
          <%= button_to "Regenerate Link",
                        regenerate_share_token_insight_item_path(insight_item),
                        method: :post,
                        class: "btn btn-ghost btn-sm",
                        data: { turbo_confirm: "This will invalidate the current share link. Continue?" } %>
        </div>
      </div>
    <% else %>
      <%# Published but sharing not enabled %>
      <p class="text-sm text-base-content/70 mb-3">
        Create a public link to share this insight with anyone.
      </p>
      <%= button_to "Enable Share Link",
                    enable_share_insight_item_path(insight_item),
                    method: :post,
                    class: "btn btn-primary btn-sm w-full" %>
    <% end %>
  <% else %>
    <%# Draft - cannot share %>
    <div class="alert alert-warning">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
      </svg>
      <span class="text-sm">Publish this insight to enable sharing.</span>
    </div>
  <% end %>
</div>
